"use strict";(self["webpackChunkdev"]=self["webpackChunkdev"]||[]).push([[1146],{7646:function(t,e,s){s.r(e),s.d(e,{default:function(){return f}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"request"},[e("header",{attrs:{flex:"",jsb:"",ac:""}},[e("div",{attrs:{flex:""}},[e("btn",{attrs:{flat:"",blue:"",bg:"",sm:"","pl-sm":"","pr-lg":"","ht-3":"",tile:"","mr-xl":"",disabled:!t.stat.create},on:{click:function(e){return t.$refs.formset.dispatch("create")}}},[e("i",{attrs:{xl:"","nu-md":"","wd-1":""}},[t._v("＋")]),e("i",{attrs:{"nu-xs":""}},[t._v("新增")])]),e("btn",{directives:[{name:"show",rawName:"v-show",value:t.$store.state.devOption.qualityControl.requestDeletable&&!t.stat.selecting,expression:"$store.state.devOption.qualityControl.requestDeletable && !stat.selecting"}],attrs:{flat:"",blue:"",bg:"",sm:"","pl-sm":"","pr-lg":"","ht-3":"",tile:"","mr-xl":"",disabled:!t.stat.create},on:{click:function(e){t.$refs.formset.dispatch("toggleSelect"),t.toggleSelect()}}},[e("ico",{attrs:{"ml-sm":"","mr-xs":"",md:"","nu-xs":""}},[t._v("cbrankic-hecked")]),e("i",{attrs:{"nu-xs":""}},[t._v("选择")])],1),e("btn",{directives:[{name:"show",rawName:"v-show",value:t.$store.state.devOption.qualityControl.requestDeletable&&t.stat.selecting,expression:"$store.state.devOption.qualityControl.requestDeletable && stat.selecting"}],attrs:{flat:"",blue:"",outlined:"",sm:"","pl-sm":"","pr-lg":"","ht-3":"",tile:"","mr-xl":"",disabled:!t.stat.create},on:{click:function(e){t.$refs.formset.dispatch("toggleSelect"),t.toggleSelect()}}},[e("ico",{attrs:{"ml-sm":"","mr-xs":"",md:"","nu-xs":""}},[t._v("brankic-error")]),e("i",{attrs:{"nu-xs":""}},[t._v("取消")])],1),t.$store.state.devOption.qualityControl.requestDeletable?e("btn",{attrs:{flat:"",red:"",outlined:"",sm:"","pl-sm":"","pr-lg":"","ht-3":"",tile:"","mr-xl":"",disabled:!t.stat.create},on:{click:function(e){return t.$refs.formset.dispatch("deleteSelected")}}},[e("ico",{attrs:{"ml-sm":"","mr-xs":"",sm:"","nu-sm":""}},[t._v("icoMoon-bin")]),e("i",{attrs:{"nu-xs":""}},[t._v("删除")])],1):t._e()],1),e("field",{directives:[{name:"addon",rawName:"v-addon:suffix",value:t.searchIcon,expression:"searchIcon",arg:"suffix"}],staticClass:"searchBox",attrs:{outlined:"",tile:"",xs:"",placeholder:"精确搜索: 请输入日期、名称或功能查找服务"},on:{enter:t.search,clickSearch:t.search},model:{value:t.stat.search,callback:function(e){t.$set(t.stat,"search",e)},expression:"stat.search"}})],1),e("main",{attrs:{catskill:"",lighten:"",bg:"","sm-pa":"","pa-sm":"",flex:"",js:"",card:""}},[e("formset",{ref:"formset",attrs:{"lg-pt":"","pt-lg":"","api:subject":"qualityControl/request/raw/form","api:primary":"requestGuid",noselect:!t.requestDeletable,columns:t.columns,patch:{tabular:{width:"1100px"}}},on:{opened:t.opened,closed:t.closed},scopedSlots:t._u([{key:"form",fn:function(){return[e("div",{staticClass:"sketch210813",attrs:{flex:"",jc:"",loading:t.loading}},[e("div",{staticStyle:{width:"1100px"}},[e("h2",{staticStyle:{"margin-top":"-20px"},attrs:{jc:"","xl-ls":"","ls-xl":"","md-mb":"","mb-lg":""}},[t._v("请验单")]),e("table",{attrs:{"xl-mb":"","mb-xl":""}},[e("tr",[e("td",{staticClass:"col-1",attrs:{bold:"","ls-sm":""}},[e("i",{attrs:{"wd-14":"",jj:""}},[t._v("入库暂存单编号")])]),e("td",{staticClass:"col-2",attrs:{bold:"","ls-sm":"",jc:""}},[t._v("ZC 2019040601")]),e("td",{staticClass:"col-3",attrs:{bold:"","ls-sm":"",jc:""}},[e("i",{attrs:{"wd-11":"",jj:""}},[t._v("请验单编号")])]),e("td",{staticClass:"col-4",attrs:{jc:""}},[t._v(t._s(t.form.requestNum))]),e("td",{staticClass:"col-5",attrs:{bold:"",jc:""}},[e("div",{attrs:{"wd-14":"",jj:"","mx-auto":""}},[t._v("模 板")])]),e("td",{staticClass:"col-6 value input"},[e("div",{staticClass:"constraint"},[e("field",{directives:[{name:"valid",rawName:"v-valid:require",arg:"require"}],attrs:{select:"",fill:"",tile:"",blue:"","pl-md":"",jc:"",items:t.rawTemplateNames,disabled:!t.form.isNew,placeholder:"选择检验模板"},on:{enter:t.enter,select:t.select},model:{value:t.form.materialName,callback:function(e){t.$set(t.form,"materialName",e)},expression:"form.materialName"}})],1)])]),e("tr",[e("td",{staticClass:"col-1",attrs:{bold:"","ls-lg":""}},[e("i",{attrs:{"wd-14":"",jj:""}},[t._v("样品编码")])]),e("td",{attrs:{jc:""}},[t._v(t._s(t.form.sampleNum))]),e("td",{attrs:{jc:"","ls-lg":""}},[e("i",{attrs:{"wd-11":"",jj:"",bold:""}},[t._v("样品数量")])]),e("td",{attrs:{jc:"",relative:""}},[e("field",{attrs:{relative:"",fill:"",noborder:"",invalid:!t.sampleQuantityEditable},on:{enter:function(e){t.handleSampleQuantity(),t.createSampleTime()}},model:{value:t.form.sampleQuantity,callback:function(e){t.$set(t.form,"sampleQuantity",e)},expression:"form.sampleQuantity"}}),t.form.sampleQuantity?t._e():e("div",{staticClass:"sampleQuantity",attrs:{"ls-sm":""}},[t._v(t._s("("+t.suggest.quantity+"g)品控取样后填写"))])],1),e("td",{attrs:{jc:"","ls-lg":""}},[e("i",{attrs:{"wd-14":"",jj:"",bold:""}},[t._v("取样/送样时间")])]),e("td",{attrs:{jc:"","ls-sm":""}},[e("div",{class:{pink:!Boolean(t.form.sampleTime)}},[t._v(t._s(t.form.sampleTime?t.form.sampleTime:"系统带出"))])])]),e("tr",{attrs:{noselect:""}},[e("td",{attrs:{colspan:"6",md:"",bold:"",jc:"","md-ls":"","ls-xl":""}},[t._v(" 检验项目 ")])]),t._l(t.form.items,(function(s,a){return a<4?e("tr",{attrs:{noselect:""}},[e("td",{attrs:{colspan:"6"}},[e("div",{staticClass:"upperBox",attrs:{flex:"",bb:""}},[e("div",{staticClass:"groupName",attrs:{bold:"","ls-lg":""}},[t._v(" "+t._s(t.groupNames[a])+" ")]),e("div",{staticClass:"selectAll"},[e("field",{directives:[{name:"inject",rawName:"v-inject:label",value:"全 选",expression:"'全 选'",arg:"label"},{name:"addon",rawName:"v-addon:prefix",value:t.selectAllBox,expression:"selectAllBox",arg:"prefix"}],class:{immutable:!t.mutable},attrs:{check:"",noborder:"",invalid:!t.mutable},on:{click:function(e){return t.toggleSelectAll(a)}},model:{value:t.selectAll[a],callback:function(e){t.$set(t.selectAll,a,e)},expression:"selectAll[groupIndex]"}})],1)]),e("div",{staticClass:"itemBox",class:{fix:1===a}},t._l(s.list,(function(s,l){return e("field",{directives:[{name:"addon",rawName:"v-addon:prefix",value:t.dotCheckBox,expression:"dotCheckBox",arg:"prefix"},{name:"inject",rawName:"v-inject:label",value:s.label,expression:"item.label",arg:"label"},{name:"inject",rawName:"v-inject:groupIndex",value:a,expression:"groupIndex",arg:"groupIndex"}],class:{immutable:!t.mutable},attrs:{check:"",noborder:"","ml-lg":"",sm:"",invalid:!t.mutable},on:{change:function(e){return t.toggleItem(a,l)}},model:{value:s.valid,callback:function(e){t.$set(s,"valid",e)},expression:"item.valid"}})})),1)])]):t._e()}))],2),e("div",{attrs:{"xl-mt":"","mt-lg":"","pt-xl":"",flex:"",je:""}},[e("btn",{attrs:{round:"","wd-12":"","xl-mr":"","mr-md":""},on:{click:function(e){return t.form.close()}}},[t._v("取消")]),e("btn",{attrs:{round:"","wd-12":"","xl-mr":"","mr-md":"",invalid:""}},[t._v("暂存")]),e("btn",{attrs:{round:"","wd-12":"","xl-ml":"",blue:"",bg:"",pending:t.pending,disabled:0===t.form.items.length},on:{click:t.submit}},[t._v(" 提交 ")])],1),e("gap",{attrs:{"py-xl":""}})],1)])]},proxy:!0}])})],1)])},l=[],i=(s(4114),s(4374)),r=s(6017),m=s(5835),n=s(4353),o=s.n(n),d=s(7920),u={name:"request-raw",mixins:[d["default"]],data(){return{form:{requestGuid:0,requestNum:"",sampleNum:"",templateGuid:0,vendorName:"",batchNum:"",sampleQuantity:"",materialName:"",requestTime:"",sampleTime:"",sampler:"",requestStateCode:0,requestTypeIndex:0,items:[]},columns:[{label:"日期",value:"requestTime"},{label:"入库暂存单编号",value:"tempStorageNum",width:180,component:m["default"]},{label:"请验单编号",value:"requestNum",width:180,component:i.A},{label:"供应商编号",value:"vendorNum",width:140},{label:"样品编码",value:"sampleNum",width:140,component:r.A},{label:"取样人",value:"sampler",width:120},{label:"是否入库",value:"receipted"}],templates:[],rawTemplateGuids:[],rawTemplateNames:[],templateTypeIndex:null,templateGuid:0,openBySampleNum:!0}},computed:{url(){return{availableRequestNum:"/qualityControl/request/raw/form/availableRequestNum",templateNames:"/qualityControl/request/raw/templateNames",items:`/qualityControl/template/raw/${this.templateGuid}/items`}}},methods:{opened(){this.stat.create=!1,this.resetTemplate(),this.$http.get(this.url.templateNames).then((t=>{this.rawTemplateGuids=[],this.rawTemplateNames=[];for(let e of t.data)this.rawTemplateGuids.push(e.templateGuid),this.rawTemplateNames.push(e.templateName)})),this.form.isNew?(this.$http.get("/qualityControl/template/semi/0/items").then((t=>{console.log(t.data),this.form.items=t.data,this.initSelectAll(),this.loading=!1})),this.$http.get(this.url.availableRequestNum).then((t=>{this.form.requestNum="QYY "+t.data,this.form.sampleNum="S "+t.data}))):this.getFormByRequestGuid()},resetTemplate(){this.form.items=[],this.templateTypeIndex=null,this.templateGuid=0},enter(t){let e=t.trim();if(this.rawTemplateNames.includes(e))for(let s=0;s<this.rawTemplateNames.length;s++)this.rawTemplateNames[s]===e&&(this.templateTypeIndex=1,this.templateGuid=this.rawTemplateGuids[s],this.getItems());else this.templateTypeIndex=0,this.templateGuid=1,this.getItems()},select(t,e){this.templateTypeIndex=1,this.templateGuid=this.rawTemplateGuids[e],this.getItems()},getItems(){this.stat.gettingItems=!0,this.$http.get(this.url.items).then((t=>{this.form.items=t.data,this.$hint("检验项目已更新"),this.initSelectAll(),this.stat.gettingItems=!1}))},submit(){this.pending=!0,this.form.requestStateCode=Boolean(this.form.sampleQuantity)?1:0,this.form.requestTime||(this.form.requestTime=o()().format("YYYY-MM-DD HH:mm"));for(let t of this.form.items)for(let e of t.list)"速溶性"===e.label&&(e.valid=!1);this.form.submit().then((t=>{"Validator"!==t?(1!==t&&0!==t&&alert("服务器出现问题，请刷新重试"),this.pending=!1):this.pending=!1}))}}},c=u,p=s(1656),h=(0,p.A)(c,a,l,!1,null,"f396bcbe",null),f=h.exports}}]);