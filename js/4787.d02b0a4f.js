(self["webpackChunkdev"]=self["webpackChunkdev"]||[]).push([[4787],{1733:function(t,e,r){"use strict";r.d(e,{A:function(){return l}});var i=function(){var t=this,e=t._self._c;return e("ico",{attrs:{grey:"",lighten:"","pr-md":"","sm-pr":"",pointer:""},on:{click:function(e){return t.$parent.$emit("clickSearch")}}},[t._v("search-magnify")])},s=[],n={name:"searchIcon"},a=n,o=r(1656),u=(0,o.A)(a,i,s,!1,null,null,null),l=u.exports},4787:function(t,e,r){"use strict";r.r(e),r.d(e,{default:function(){return c}});var i,s,n=r(4353),a=r.n(n),o=r(1733),u={name:"mixin",mounted(){this.$route.query.requestGuid&&(this.form.requestGuid=this.$route.query.requestGuid,this.$refs.formset.openForm())},data(){return{searchIcon:o.A,stat:{search:""},form:{requestGuid:0,requestNum:"",sampleNum:"",templateGuid:0,batchNum:"",requestTime:"",workflowData:{},inspector:"",conclusion:"",updateTime:"",reportTime:"",resultStateCode:0,items:[{list:[]},{list:[]},{list:[]},{list:[]},{list:[]},{list:[]}]},resultState:["未录入","录入中","已完成"],groupNames:["感官指标","理化指标","微生物 限量指标","重金属 限量指标","营养成分","其他"],datePlaceholder:"-",visible:!1,pending:!1,boilingData:["","","","",""],thermalData:["","","","",""],"凝胶强度":null,"速溶性":null,revise:{conclusion:!0,verifier:!0}}},provide(){return{boilingData:this.boilingData,thermalData:this.thermalData,resultEditable:this.resultEditable,datePlaceholder:this.datePlaceholder}},watch:{boilingData(t){for(let e=0;e<t.length;e++)t[e].length>4&&(t[e]=t[e].slice(0,4)),""!==t[e]&&(t[e]=parseInt(t[e]));if(t.includes(""))this.凝胶强度.value="",this.速溶性.value="";else{let e=0;for(let r of t)e+=r;if(this.凝胶强度.value=Math.ceil(e/5),!this.thermalData.includes("")){let t=0;for(let e of this.thermalData)t+=e;this.速溶性.value=(Math.ceil(t/5)/this.凝胶强度.value).toFixed(2)}}},thermalData(t){for(let e=0;e<t.length;e++)t[e].length>4&&(t[e]=t[e].slice(0,4)),""!==t[e]&&(t[e]=parseInt(t[e]));if(t.includes(""))this.速溶性.value="";else if(this.boilingData.includes(""))this.速溶性.value="";else{let e=0;for(let r of t)e+=r;this.速溶性.value=(Math.ceil(e/5)/this.凝胶强度.value).toFixed(2)}}},computed:{auditing(){return this.$store.state.user.info.roleIndex>=1&&2===this.form.resultStateCode},noSubmit(){return!this.resultEditable&&(0===this.$store.state.user.info.roleIndex?2===this.form.resultStateCode||4===this.form.resultStateCode:2!==this.form.resultStateCode)},resultEditable(){return this.$store.state.devOption.qualityControl.resultEditable||3===this.form.resultStateCode},url(){return{formData:`/qualityControl/form/${this.form.requestGuid}`}},requestTime(){return this.form.requestTime},rowspanItems(){let t=new Array(this.form.items.length).fill(null),e=0;for(let r of this.form.items){for(let i of r.list)if(i.valid){t[e]=i;break}e++}return t}},methods:{search(){console.log("search")},checkConclusionAvailable(){let t=!1;for(let e of this.form.items)for(let r of e.list)if(r.valid&&!r.value&&r.date===this.datePlaceholder){t=!0;break}if(t){this.$hint({innerHTML:"请先提交全部的检验数据",color:"#dd0000"});let t=event.currentTarget.getElementsByTagName("input")[0];this.$nextTick((()=>{t.blur()}))}},initMixin(){this.revise.conclusion=!0,this.revise.verifier=!0},getRowspanFrom(t){let e=0;for(let r of t.list)r.valid&&e++;return e},getGroupName(t,e){return this.rowspanItems.includes(e)?this.groupNames[t]:""},closed(){this.visible=!1,this.initMixin()},checkSubmitted(){for(let t of this.form.items)for(let e of t.list)e.valid&&!e.submitted&&(e.submitted=e.date!==this.datePlaceholder);this.form.conclusion&&(this.revise.conclusion=!1)},opened(){this.$http.get(this.url.formData).then((t=>{let e=t.data;e.workflowData=e.workflowData?JSON.parse(e.workflowData):{};let r=Object.getOwnPropertyNames(this.form);e.items=JSON.parse(e.items);for(let i of e.items)for(let t of i.list)t.value||(t.value=""),t.inspector||(t.inspector=""),t.resultCode||(t.resultCode=0),t.date||(t.date=this.datePlaceholder),"凝胶强度"===t.label&&(this.凝胶强度=t),"速溶性"===t.label&&(this.速溶性=t),t.submitted=!1;for(let i of r)e[i]&&(this.form[i]=e[i]);if(this.checkSubmitted(),this.form.workflowData&&this.form.workflowData.boilingData)for(let i=0;i<this.form.workflowData.boilingData.length;i++)this.boilingData[i]=this.form.workflowData.boilingData[i];else for(let i=0;i<this.boilingData.length;i++)this.boilingData[i]="";if(this.form.workflowData&&this.form.workflowData.thermalData)for(let i=0;i<this.form.workflowData.thermalData.length;i++)this.thermalData[i]=this.form.workflowData.thermalData[i];else for(let i=0;i<this.thermalData.length;i++)this.thermalData[i]="";this.visible=!0}))},reject(){this.pending=!0,this.handleResult(),this.form.resultStateCode=3,delete this.form.verifier,this.form.submit().then((t=>{1!==t&&0!==t?alert("服务器出现问题，请刷新重试"):(this.$hint({innerHTML:"数据审核已驳回",color:"red"}),this.checkSubmitted()),this.pending=!1}))},verified(){this.pending=!0,this.handleResult(),this.form.resultStateCode=4,this.form.verifier=this.$store.state.user.info.fullName,this.form.submit().then((t=>{1!==t&&0!==t?alert("服务器出现问题，请刷新重试"):(this.$hint("已通过审核"),this.checkSubmitted()),this.pending=!1}))},handleResult(){this.form.updateTime=a()().format("YYYY-MM-DD HH:mm");let t=0,e=0,r="";for(let i of this.form.items)for(let s of i.list)if(s.valid){if("凝胶强度"===s.label&&Boolean(s.value)&&s.basis.includes("/"))return this.$hint({innerHTML:"请为 "+s.label+" 选择检测方法",color:"red"}),void(this.pending=!1);t++,s.value&&s.inspector&&(e++,s.locked=!0);let i=s.inspector.trim();r.includes(i)||(""!==r&&(r+=", "),r+=i)}this.form.inspector=r,2!==this.form.resultStateCode&&(this.form.resultStateCode=0===e?0:e<t?1:2),2===this.form.resultStateCode&&""===this.form.reportTime&&(this.form.reportTime=a()().format("YYYY-MM-DD HH:mm")),2===this.form.resultStateCode&&(this.form.conclusion||(this.form.resultStateCode=1)),this.form.workflowData={boilingData:this.boilingData,thermalData:this.thermalData},this.form.workflowData=JSON.stringify(this.form.workflowData)},submit(){this.pending=!0,this.handleResult(),this.form.submit(null,null,!1).then((t=>{1!==t&&0!==t?alert("服务器出现问题，请刷新重试"):(this.$hint("检验数据已提交"),this.checkSubmitted()),this.pending=!1}))}}},l=u,h=r(1656),f=(0,h.A)(l,i,s,!1,null,null,null),c=f.exports},4353:function(t){!function(e,r){t.exports=r()}(0,(function(){"use strict";var t=1e3,e=6e4,r=36e5,i="millisecond",s="second",n="minute",a="hour",o="day",u="week",l="month",h="quarter",f="year",c="date",d="Invalid Date",m=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,$=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,D={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(t){var e=["th","st","nd","rd"],r=t%100;return"["+t+(e[(r-20)%10]||e[r]||e[0])+"]"}},g=function(t,e,r){var i=String(t);return!i||i.length>=e?t:""+Array(e+1-i.length).join(r)+t},v={s:g,z:function(t){var e=-t.utcOffset(),r=Math.abs(e),i=Math.floor(r/60),s=r%60;return(e<=0?"+":"-")+g(i,2,"0")+":"+g(s,2,"0")},m:function t(e,r){if(e.date()<r.date())return-t(r,e);var i=12*(r.year()-e.year())+(r.month()-e.month()),s=e.clone().add(i,l),n=r-s<0,a=e.clone().add(i+(n?-1:1),l);return+(-(i+(r-s)/(n?s-a:a-s))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:l,y:f,w:u,d:o,D:c,h:a,m:n,s:s,ms:i,Q:h}[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},p="en",b={};b[p]=D;var w="$isDayjsObject",S=function(t){return t instanceof O||!(!t||!t[w])},M=function t(e,r,i){var s;if(!e)return p;if("string"==typeof e){var n=e.toLowerCase();b[n]&&(s=n),r&&(b[n]=r,s=n);var a=e.split("-");if(!s&&a.length>1)return t(a[0])}else{var o=e.name;b[o]=e,s=o}return!i&&s&&(p=s),s||!i&&p},y=function(t,e){if(S(t))return t.clone();var r="object"==typeof e?e:{};return r.date=t,r.args=arguments,new O(r)},k=v;k.l=M,k.i=S,k.w=function(t,e){return y(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var O=function(){function D(t){this.$L=M(t.locale,null,!0),this.parse(t),this.$x=this.$x||t.x||{},this[w]=!0}var g=D.prototype;return g.parse=function(t){this.$d=function(t){var e=t.date,r=t.utc;if(null===e)return new Date(NaN);if(k.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var i=e.match(m);if(i){var s=i[2]-1||0,n=(i[7]||"0").substring(0,3);return r?new Date(Date.UTC(i[1],s,i[3]||1,i[4]||0,i[5]||0,i[6]||0,n)):new Date(i[1],s,i[3]||1,i[4]||0,i[5]||0,i[6]||0,n)}}return new Date(e)}(t),this.init()},g.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},g.$utils=function(){return k},g.isValid=function(){return!(this.$d.toString()===d)},g.isSame=function(t,e){var r=y(t);return this.startOf(e)<=r&&r<=this.endOf(e)},g.isAfter=function(t,e){return y(t)<this.startOf(e)},g.isBefore=function(t,e){return this.endOf(e)<y(t)},g.$g=function(t,e,r){return k.u(t)?this[e]:this.set(r,t)},g.unix=function(){return Math.floor(this.valueOf()/1e3)},g.valueOf=function(){return this.$d.getTime()},g.startOf=function(t,e){var r=this,i=!!k.u(e)||e,h=k.p(t),d=function(t,e){var s=k.w(r.$u?Date.UTC(r.$y,e,t):new Date(r.$y,e,t),r);return i?s:s.endOf(o)},m=function(t,e){return k.w(r.toDate()[t].apply(r.toDate("s"),(i?[0,0,0,0]:[23,59,59,999]).slice(e)),r)},$=this.$W,D=this.$M,g=this.$D,v="set"+(this.$u?"UTC":"");switch(h){case f:return i?d(1,0):d(31,11);case l:return i?d(1,D):d(0,D+1);case u:var p=this.$locale().weekStart||0,b=($<p?$+7:$)-p;return d(i?g-b:g+(6-b),D);case o:case c:return m(v+"Hours",0);case a:return m(v+"Minutes",1);case n:return m(v+"Seconds",2);case s:return m(v+"Milliseconds",3);default:return this.clone()}},g.endOf=function(t){return this.startOf(t,!1)},g.$set=function(t,e){var r,u=k.p(t),h="set"+(this.$u?"UTC":""),d=(r={},r[o]=h+"Date",r[c]=h+"Date",r[l]=h+"Month",r[f]=h+"FullYear",r[a]=h+"Hours",r[n]=h+"Minutes",r[s]=h+"Seconds",r[i]=h+"Milliseconds",r)[u],m=u===o?this.$D+(e-this.$W):e;if(u===l||u===f){var $=this.clone().set(c,1);$.$d[d](m),$.init(),this.$d=$.set(c,Math.min(this.$D,$.daysInMonth())).$d}else d&&this.$d[d](m);return this.init(),this},g.set=function(t,e){return this.clone().$set(t,e)},g.get=function(t){return this[k.p(t)]()},g.add=function(i,h){var c,d=this;i=Number(i);var m=k.p(h),$=function(t){var e=y(d);return k.w(e.date(e.date()+Math.round(t*i)),d)};if(m===l)return this.set(l,this.$M+i);if(m===f)return this.set(f,this.$y+i);if(m===o)return $(1);if(m===u)return $(7);var D=(c={},c[n]=e,c[a]=r,c[s]=t,c)[m]||1,g=this.$d.getTime()+i*D;return k.w(g,this)},g.subtract=function(t,e){return this.add(-1*t,e)},g.format=function(t){var e=this,r=this.$locale();if(!this.isValid())return r.invalidDate||d;var i=t||"YYYY-MM-DDTHH:mm:ssZ",s=k.z(this),n=this.$H,a=this.$m,o=this.$M,u=r.weekdays,l=r.months,h=r.meridiem,f=function(t,r,s,n){return t&&(t[r]||t(e,i))||s[r].slice(0,n)},c=function(t){return k.s(n%12||12,t,"0")},m=h||function(t,e,r){var i=t<12?"AM":"PM";return r?i.toLowerCase():i};return i.replace($,(function(t,i){return i||function(t){switch(t){case"YY":return String(e.$y).slice(-2);case"YYYY":return k.s(e.$y,4,"0");case"M":return o+1;case"MM":return k.s(o+1,2,"0");case"MMM":return f(r.monthsShort,o,l,3);case"MMMM":return f(l,o);case"D":return e.$D;case"DD":return k.s(e.$D,2,"0");case"d":return String(e.$W);case"dd":return f(r.weekdaysMin,e.$W,u,2);case"ddd":return f(r.weekdaysShort,e.$W,u,3);case"dddd":return u[e.$W];case"H":return String(n);case"HH":return k.s(n,2,"0");case"h":return c(1);case"hh":return c(2);case"a":return m(n,a,!0);case"A":return m(n,a,!1);case"m":return String(a);case"mm":return k.s(a,2,"0");case"s":return String(e.$s);case"ss":return k.s(e.$s,2,"0");case"SSS":return k.s(e.$ms,3,"0");case"Z":return s}return null}(t)||s.replace(":","")}))},g.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},g.diff=function(i,c,d){var m,$=this,D=k.p(c),g=y(i),v=(g.utcOffset()-this.utcOffset())*e,p=this-g,b=function(){return k.m($,g)};switch(D){case f:m=b()/12;break;case l:m=b();break;case h:m=b()/3;break;case u:m=(p-v)/6048e5;break;case o:m=(p-v)/864e5;break;case a:m=p/r;break;case n:m=p/e;break;case s:m=p/t;break;default:m=p}return d?m:k.a(m)},g.daysInMonth=function(){return this.endOf(l).$D},g.$locale=function(){return b[this.$L]},g.locale=function(t,e){if(!t)return this.$L;var r=this.clone(),i=M(t,e,!0);return i&&(r.$L=i),r},g.clone=function(){return k.w(this.$d,this)},g.toDate=function(){return new Date(this.valueOf())},g.toJSON=function(){return this.isValid()?this.toISOString():null},g.toISOString=function(){return this.$d.toISOString()},g.toString=function(){return this.$d.toUTCString()},D}(),C=O.prototype;return y.prototype=C,[["$ms",i],["$s",s],["$m",n],["$H",a],["$W",o],["$M",l],["$y",f],["$D",c]].forEach((function(t){C[t[1]]=function(e){return this.$g(e,t[0],t[1])}})),y.extend=function(t,e){return t.$i||(t(e,O,y),t.$i=!0),y},y.locale=M,y.isDayjs=S,y.unix=function(t){return y(1e3*t)},y.en=b[p],y.Ls=b,y.p={},y}))}}]);