"use strict";(self["webpackChunkdev"]=self["webpackChunkdev"]||[]).push([[2196],{1733:function(t,e,s){s.d(e,{A:function(){return c}});var a=function(){var t=this,e=t._self._c;return e("ico",{attrs:{grey:"",lighten:"","pr-md":"","sm-pr":"",pointer:""},on:{click:function(e){return t.$parent.$emit("clickSearch")}}},[t._v("search-magnify")])},i=[],r={name:"searchIcon"},l=r,n=s(1656),d=(0,n.A)(l,a,i,!1,null,null,null),c=d.exports},2972:function(t,e,s){s.r(e),s.d(e,{default:function(){return c}});var a=function(){var t=this,e=t._self._c;return e("div",[e("modal",{staticClass:"userManagementDept",attrs:{nomask:"",persistent:"",noselect:""},on:{close:function(e){return t.$emit("close")}},model:{value:t.stat.dept.valid,callback:function(e){t.$set(t.stat.dept,"valid",e)},expression:"stat.dept.valid"}},[e("div",{staticClass:"subDeptCard",attrs:{catskill:"",lighten:"",bg:""}},[e("header",{staticClass:"bar",attrs:{flex:"",jsb:"",ac:""}},[e("div",{attrs:{"ls-xl":""}},[t._v(t._s(t.titles[t.stat.dept.titleIndex]))]),e("ico",{attrs:{xs:"",pointer:"",bold:""},on:{click:t.closeModal}},[t._v("ui-close")])],1),e("main",[e("table",{attrs:{sm:""}},[e("tbody",[e("tr",[e("td",{staticClass:"field"},[t._v("部门名称")]),e("td",{staticClass:"value"},[e("field",{attrs:{fill:"",noborder:"","pl-xl":"",ac:""},model:{value:t.data.dept.name,callback:function(e){t.$set(t.data.dept,"name",e)},expression:"data.dept.name"}},[t._v("必填")])],1)]),e("tr",[e("td",{staticClass:"field"},[t._v("部门负责人")]),e("td",{staticClass:"value",attrs:{relative:"","z-index-5":""}},[e("field",{staticStyle:{transform:"translateY(0)"},attrs:{select:"",fill:"",tile:"","pl-xl":"",ac:"",placeholder:"必填"},model:{value:t.data.dept.manager_fullName,callback:function(e){t.$set(t.data.dept,"manager_fullName",e)},expression:"data.dept.manager_fullName"}},[e("div",{staticClass:"scrollBox"},t._l(t.managerList,(function(s){return e("div",{staticClass:"selectSlot",on:{click:function(e){return t.selectManager(s)}}},[e("div",{staticClass:"item"},[t._v(t._s("["+t.roles[s.roleIndex]+"] "+s.fullName))])])})),0)])],1)]),e("tr",[e("td",{staticClass:"field"},[t._v("部门电话")]),e("td",{staticClass:"value"},[e("field",{attrs:{fill:"",noborder:"","pl-xl":"",ac:""},model:{value:t.data.dept.officePhone,callback:function(e){t.$set(t.data.dept,"officePhone",e)},expression:"data.dept.officePhone"}},[t._v("选填")])],1)]),e("tr",[e("td",{staticClass:"field"},[t._v("上级部门")]),e("td",{staticClass:"value",attrs:{relative:"","z-index-4":""}},[e("field",{staticStyle:{transform:"translateY(0)"},attrs:{select:"",fill:"",tile:"","pl-xl":"",ac:"",invalid:t.data.dept.superiorDeptItem&&0===t.data.dept.superiorDeptItem.id,placeholder:"必填"},model:{value:t.data.dept.superiorDeptName,callback:function(e){t.$set(t.data.dept,"superiorDeptName",e)},expression:"data.dept.superiorDeptName"}},t._l(t.data.tree.companys,(function(s,a){return e("div",{key:"company-"+a,staticClass:"selectSlot"},[e("div",{staticClass:"company item",class:{invalid:s.unselectable},on:{click:function(e){return t.selectSuperiorDept(s)}}},[t._v(" "+t._s(s.name)+" ")]),t._l(s.children,(function(s,a){return e("div",{key:"dept-"+a},[e("div",{staticClass:"dept item",class:{invalid:s.unselectable},on:{click:function(e){return t.selectSuperiorDept(s)}}},[t._v(" "+t._s(s.name)+" ")]),t._l(s.children,(function(s,a){return e("div",{key:"subDeptIndex-"+a},[e("div",{staticClass:"subDept item",class:{invalid:s.unselectable},on:{click:function(e){return t.selectSuperiorDept(s)}}},[t._v(" "+t._s(s.name)+" ")])])}))],2)}))],2)})),0)],1)])])]),e("div",{staticClass:"btnBox",attrs:{flex:"",jsb:"",ac:"","mt-xl":"","xl-mt":""}},[e("div",[t.deletable&&t.data.dept.id?e("btn",{attrs:{outlined:"",red:"",sm:"",title:"请慎重操作",pending:t.stat.dept.pending},on:{click:t.showDelete}},[t._v(" 删除 ")]):t._e()],1),e("div",{attrs:{flex:""}},[e("btn",{attrs:{flat:"",sm:"",grey:"",bg:"","mr-xl":""},on:{click:t.closeModal}},[t._v("取消")]),e("btn",{attrs:{flat:"",sm:"",grey:"",bg:"","mr-xl":"",invalid:""}},[t._v("暂存")]),e("btn",{attrs:{flat:"",sm:"",blue:"",bg:"","mr-md":"",pending:t.stat.dept.pending},on:{click:t.submitDept}},[t._v("提交")])],1)])])])]),e("modal",{attrs:{relative:"","z-index-1":"",persistent:"",noselect:""},model:{value:t.stat.dept.deleteConfirm,callback:function(e){t.$set(t.stat.dept,"deleteConfirm",e)},expression:"stat.dept.deleteConfirm"}},[e("p",{attrs:{lg:"",catskill:"",lighten:"",bold:"","ls-sm":""}},[t._v(" "+t._s("确认要删除【"+t.data.dept.name+"】吗？ 删除部门不影响其成员数据")+" ")]),e("div",{attrs:{flex:"",je:"",ac:"","mt-xl":"","md-mt":"","py-xl":""}},[e("btn",{attrs:{sm:"","py-sm":"","px-xl":"",outlined:"",red:"",lighten:"","mr-xl":"","md-mr":"",pending:t.stat.dept.pending},on:{click:t.deleteDept}},[t._v(" 删除 ")]),e("btn",{attrs:{sm:"","py-sm":"","px-xl":"",outlined:"",green:""},on:{click:function(e){t.stat.dept.deleteConfirm=!1}}},[t._v("返回")])],1)])],1)},i=[],r=(s(4114),{name:"userManagementDept",inject:["data","stat","snap","api"],props:["getTrees"],data(){return{titles:["添加子部门","修改部门信息"],roles:["员工","主管","经理","高管"],managerList:[],followers:[]}},computed:{deletable(){return this.$store.state.devOption.department.deletable}},watch:{"stat.dept.valid":{handler:function(t){if(t){let t=this.stat.tree.current;switch(this.stat.dept.action){case"insert":if(this.initManagerList(),t){let e=t.level.split(".");if(e.length>4){let e=this.getSuperiorDeptBy(t.level);this.data.dept.superiorDeptItem=e,this.data.dept.superiorDeptName=e.name}else this.data.dept.superiorDeptItem=t,this.data.dept.superiorDeptName=t.name}break;case"update":this.initManagerList().then((e=>{for(let s=0;s<e.length;s++)if(e[s].id===parseInt(t.manager_id)){this.data.dept.manager_fullName=e[s].fullName,this.data.dept.managerItem=e[s];break}}));for(let s in t)this.data.dept[s]=t[s];let e=this.getSuperiorDeptBy(t.level);this.data.dept.superiorDeptItem=e,this.data.dept.superiorDeptName=e.name,this.data.dept.rawLevel=e.level+e.id+".",this.checkUnselectable();break}}else this.resetDept(),this.clearUnselectable()}}},methods:{checkUnselectable(){let t=Object.keys(this.data.tree),e=t[this.stat.tree.current.level.split(".").length-2];for(let s=0;s<t.length;s++)t[s]!==e&&this.data.tree[t[s]].forEach((t=>{t.unselectable=!0}))},clearUnselectable(){let t=Object.keys(this.data.tree);for(let e=0;e<t.length;e++)this.data.tree[t[e]].forEach((t=>{t.unselectable=!1}))},initManagerList(){return new Promise((t=>{this.$http.get(this.api.managers).then((e=>{this.managerList=e.data,t(e.data)}))}))},getSuperiorDeptBy(t){let e=t.split("."),s=Number(e[e.length-2]);for(let a=0;a<this.data.raws.length;a++)if(this.data.raws[a].id===s)return this.data.raws[a]},submitDept(){if(!this.data.dept.name||!this.data.dept.superiorDeptName||!this.data.dept.manager_fullName)return void this.$hint({innerHTML:"请输入完整的部门信息",color:"red"});this.stat.dept.pending=!0;let t={manager_id:parseInt(this.data.dept.manager_id),manager_fullName:this.data.dept.manager_fullName,name:this.data.dept.name,officePhone:this.data.dept.officePhone,level:this.data.dept.superiorDeptItem.level+this.data.dept.superiorDeptItem.id+".",seq:1,mtime:"",ctime:"",muser_id:1,cuser_id:1},e="update"===this.stat.dept.action?"put":"post",s="update"===this.stat.dept.action?"/"+this.stat.tree.current.id:"";if("update"===this.stat.dept.action&&t.level!==this.data.dept.rawLevel&&this.followers.length>0){for(let t of this.followers)t.level=this.data.dept.superiorDeptItem.level+this.data.dept.superiorDeptItem.id+"."+t.suffix;t.followers=this.followers,s+="?changeLevel=true"}this.$http[e](this.api.dept+s,t).then((t=>{1!==t.data&&this.$hint({innerHTML:"提交失败，请重试",color:"red"}),this.getTrees().then((()=>{this.resetDept()}))}))},showDelete(){0===this.stat.tree.current.children.length?this.stat.dept.deleteConfirm=!0:this.$hint({innerHTML:"请先删除子部门",color:"red"})},deleteDept(){this.stat.dept.pending=!0,this.$http.delete(this.api.dept+"/"+this.data.dept.id).then((t=>{1!==t.data&&this.$hint({innerHTML:"删除失败，请重试",color:"red"}),this.$emit("deleted"),this.getTrees().then((()=>{this.resetDept()}))}))},resetDept(){for(let t in this.data.dept)this.data.dept[t]=this.snap.dept[t];for(let t in this.stat.dept)this.stat.dept[t]=this.snap.stat.dept[t]},selectManager(t){this.data.dept.manager_fullName=t.fullName,this.data.dept.managerItem=t},selectSuperiorDept(t){if("update"===this.stat.dept.action){if(t.unselectable)return void this.$message.error("部门只可同级移动，请点击可用部门");let e=[],s=this.stat.tree.current.level;if(this.stat.tree.current.children.length)for(let t of this.stat.tree.current.children)if(t.suffix=t.level.split(s)[1],e.push(t),t.children.length)for(let a of t.children)a.suffix=a.level.split(s)[1],e.push(a);this.followers=e;for(let a=0;a<this.data.raws.length;a++)if(this.data.raws[a].id===t.id){t=this.data.raws[a];break}}this.data.dept.superiorDeptName=t.name,this.data.dept.superiorDeptItem=t},closeModal(){this.stat.dept.pending||(this.stat.dept.valid=!1)}}}),l=r,n=s(1656),d=(0,n.A)(l,a,i,!1,null,"5086c337",null),c=d.exports},3084:function(t,e,s){s.r(e),s.d(e,{default:function(){return c}});var a=function(){var t=this,e=t._self._c;return e("div",[e("modal",{staticClass:"userManagementFirm",attrs:{nomask:"",persistent:"",noselect:""},on:{close:function(e){return t.$emit("close")}},model:{value:t.stat.firm.valid,callback:function(e){t.$set(t.stat.firm,"valid",e)},expression:"stat.firm.valid"}},[e("div",{staticClass:"firmCard",attrs:{catskill:"",lighten:"",bg:""}},[e("header",{staticClass:"bar",attrs:{flex:"",jsb:"",ac:""}},[e("div",{attrs:{"ls-xl":""}},[t._v("添加公司")]),e("ico",{attrs:{xs:"",pointer:"",bold:""},on:{click:t.closeModal}},[t._v("ui-close")])],1),e("main",[e("div",{attrs:{"px-xl":"","py-xl":"","sm-py":"","nr-md":""}},[e("i",{attrs:{bold:"",black:"","ml-xl":""}},[t._v("公司名称：")]),t._v(" "),e("field",{attrs:{sm:"","col-20":""},model:{value:t.firmName,callback:function(e){t.firmName=e},expression:"firmName"}})],1),e("div",{staticClass:"btnBox",attrs:{flex:"",je:"",ac:"","py-xl":"","sm-py":"","pr-xl":"","sm-pr":""}},[e("div",{attrs:{flex:"","nr-md":""}},[e("btn",{attrs:{flat:"",sm:"",grey:"",bg:"","mr-xl":"",pending:t.stat.firm.pending},on:{click:t.closeModal}},[t._v("取消")]),e("btn",{attrs:{flat:"",sm:"",blue:"",bg:"","mr-md":"",pending:t.stat.firm.pending},on:{click:t.submitFirm}},[t._v("提交")])],1)])])])])],1)},i=[],r={name:"userManagementFirm",inject:["data","stat","snap","api"],data(){return{firmName:""}},watch:{"stat.firm.valid":{handler(t){t||(this.firmName="",this.$emit("post"))}}},methods:{closeModal(){this.stat.firm.pending||(this.stat.firm.valid=!1)},submitFirm(){for(let t=0;t<this.data.tree.companys.length;t++)if(this.data.tree.companys[t].name===this.firmName)return void this.$hint({innerHTML:"已存在同名公司，请修改公司名称",color:"red"});this.stat.firm.pending=!0,this.$http.post(this.api.firm,{name:this.firmName}).then((t=>{1===t.data&&(this.$hint(this.firmName+" 已添加"),this.stat.firm.valid=!1)}))}}},l=r,n=s(1656),d=(0,n.A)(l,a,i,!1,null,"5688ea6c",null),c=d.exports},2058:function(t,e,s){s.r(e),s.d(e,{default:function(){return o}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"userManagementList",attrs:{card:"","inline-block":"",catskill:"",lighten:"",bg:""}},[e("header",{staticClass:"bar",attrs:{flex:"",je:"","pr-lg":"","sm-pr":""}},[e("div",{staticClass:"funcBtn",attrs:{flex:"",jsb:"",ac:""}},[e("svg",{staticClass:"sortByTimeIcon",attrs:{height:"24",width:"24"}},[e("path",{attrs:{d:"M20 4v12h3l-4 5-4-5h3V4h2zm-8 14v2H3v-2h9zm2-7v2H3v-2h11zm0-7v2H3V4h11z"}})]),e("span",{staticClass:"name"},[t._v("最新")])])]),e("table",[e("thead",[e("tr",[e("td",{attrs:{"wd-2":""}},[e("div",{staticClass:"selectIco"},[e("field",{attrs:{xs:"","nd-md":"",check:"",cyan:"",jc:"",noborder:""},on:{click:t.selectAllRows},model:{value:t.selectAll,callback:function(e){t.selectAll=e},expression:"selectAll"}})],1)]),e("td",{staticClass:"onlined"},[t._v("是否在线")]),e("td",{staticClass:"col name"},[t._v("姓名")]),e("td",{staticClass:"col dept"},[t._v("部门")]),e("td",{staticClass:"col job"},[t._v("岗位")]),e("td",{staticClass:"col superior"},[t._v("直接上级")]),e("td",{staticClass:"col cellphone"},[t._v("联系电话")]),e("td",{staticClass:"col officePhone"},[t._v("办公室电话")]),e("td",{staticClass:"col-last",attrs:{je:""}},[e("field",{directives:[{name:"addon",rawName:"v-addon:suffix",value:t.searchIcon,expression:"searchIcon",arg:"suffix"}],staticStyle:{transform:"scale(.8)","transform-origin":"center right"},attrs:{xs:"","ht-xs":"","wd-22":"",js:"",placeholder:"高级搜索"},on:{enter:t.getUsers,clickSearch:t.getUsers},model:{value:t.stat.list.searchValue,callback:function(e){t.$set(t.stat.list,"searchValue",e)},expression:"stat.list.searchValue"}})],1)])]),e("tbody",[t._l(t.members,(function(s,a){return[s.isPlaceholder?e("tr",{staticStyle:{color:"transparent","pointer-events":"none","user-select":"none"}},[e("td",{attrs:{colspan:"9"}},[t._v("0")])]):e("tr",{key:a,class:{selected:s.selected,current:t.stat.list.current===s},on:{click:function(e){t.stat.list.current=s}}},[e("td",[e("field",{attrs:{check:"",cyan:"",jc:"",noborder:""},on:{change:t.checkSelectAll},model:{value:s.selected,callback:function(e){t.$set(s,"selected",e)},expression:"row.selected"}})],1),e("td",[t._v(" "+t._s(s.online?"是":"否")+" ")]),e("td",[t._v(t._s(s.fullName))]),e("td",[t._v(t._s(s.deptName))]),e("td",[t._v(t._s(s.position))]),e("td",[t._v(t._s(s.superiorName))]),e("td",[t._v(t._s(s.cellPhone))]),e("td",[t._v(t._s(s.officePhone))]),e("td",[e("div",{directives:[{name:"show",rawName:"v-show",value:t.stat.list.current===s,expression:"stat.list.current === row"}],attrs:{fill:"",je:"","pr-md":""}},[t.editable?e("i",{staticClass:"el-icon-edit",attrs:{pointer:"",blue:"","nd-md":"","wd-xs":"","ht-xs":"",jc:"",ac:""},on:{click:function(e){return t.edit(s)}}}):t._e()])])])]}))],2)]),e("div",{staticClass:"pageBox",attrs:{"mt-xl":"","md-mt":"",flex:"",je:""}},[e("pagination",{staticStyle:{transform:"scale(.8)"},attrs:{total:t.stat.list.amount,rowset:[15,20,25]},on:{change:t.goToPage,reset:t.reset},model:{value:t.stat.list.currentPage,callback:function(e){t.$set(t.stat.list,"currentPage",e)},expression:"stat.list.currentPage"}})],1),e("div",{attrs:{"ht-8":""}})])},i=[],r=(s(4114),s(1733)),l={name:"userManagementList",inject:["data","stat","snap","api"],created(){this.getUsers()},props:["getUsers"],data(){return{searchIcon:r.A,selectAll:!1,hoveredRow:null,filter:{search:""}}},computed:{members(){let t=this.data.list;if(t.length<this.stat.list.rowsPerPage){let e=this.stat.list.rowsPerPage-t.length;for(let s=0;s<e;s++)t.push({isPlaceholder:!0})}return t},editable(){return this.$store.state.devOption.user.editable}},methods:{reset(t){this.stat.list.rowsPerPage=t,this.stat.list.currentPage=1,this.getUsers()},goToPage(t){this.stat.list.currentPage=t,this.data.list=[],this.getUsers()},edit(){this.stat.user.action="update",this.stat.user.valid=!0},selectAllRows(){this.$nextTick((()=>{this.data.list.forEach((t=>{t.selected=this.selectAll}))}))},checkSelectAll(t){if(t){for(let t=0;t<this.data.list.length;t++)if(!1===this.data.list[t].selected)return;this.selectAll=!0}else this.selectAll=!1}}},n=l,d=s(1656),c=(0,d.A)(n,a,i,!1,null,"76ff45da",null),o=c.exports},2173:function(t,e,s){s.r(e),s.d(e,{default:function(){return c}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"userManagementTree",attrs:{card:"","inline-block":"",catskill:"",lighten:"",bg:"",noselect:""}},[e("header",{staticClass:"bar"},[t._v("组织架构")]),e("transition",{attrs:{name:"fade"}},[t.data.tree.companys.length>0?e("div",[e("div",{staticClass:"treeBox",attrs:{"pt-xl":""}},t._l(t.data.tree.companys,(function(s,a){return e("div",{staticClass:"companyBox",attrs:{sm:"","mt-lg":""}},[e("div",{staticClass:"name",class:{activated:t.stat.tree.current===s},attrs:{flex:"",ac:"",black:"",lighten:"","px-xl":"","sm-px":"","py-lg":"",draggable:"true"},on:{click:function(e){return t.select(s)}}},[e("ico",{class:{fold:s.folded},attrs:{"mr-xs":""},on:{click:function(t){s.folded=!s.folded}}},[t._v(" "+t._s(s.children.length>0?"ui-triangle":"")+" ")]),e("ico",{attrs:{lg:"","mx-xs":""}},[t._v("util-library")]),e("span",{attrs:{"ls-sm":"",bold:""}},[t._v(t._s(s.name))]),e("i",{directives:[{name:"show",rawName:"v-show",value:t.editable&&t.stat.tree.current===s,expression:"editable && stat.tree.current === company"}],staticClass:"el-icon-edit",attrs:{"wd-xs":"","ht-xs":"",jc:"",ac:"",blue:"",pointer:""},on:{click:function(e){return e.stopPropagation(),t.edit(s)}}})],1),s.folded?t._e():e("div",{staticClass:"deptBox"},t._l(s.children,(function(s,a){return e("div",{staticClass:"dept"},[e("div",{staticClass:"name",class:{activated:t.stat.tree.current===s},attrs:{flex:"",ac:"","py-lg":""},on:{click:function(e){return t.select(s)}}},[e("div",{attrs:{"sm-wd":"","wd-xl":""}}),e("i",{class:{"el-icon-folder":0===s.children.length,"el-icon-folder-add":s.children.length>0&&s.folded,"el-icon-folder-remove":s.children.length>0&&!s.folded},attrs:{"pr-sm":""},on:{click:function(e){return e.stopPropagation(),t.toggle(s)}}}),t._v(" "+t._s(s.name)+" "),e("i",{directives:[{name:"show",rawName:"v-show",value:t.editable&&t.stat.tree.current===s,expression:"editable && stat.tree.current === dept"}],staticClass:"el-icon-edit",attrs:{"wd-xs":"","ht-xs":"",jc:"",ac:"",blue:"",pointer:""},on:{click:function(e){return e.stopPropagation(),t.edit(s)}}})]),t._l(s.children,(function(a,i){return e("div",{directives:[{name:"show",rawName:"v-show",value:!s.folded,expression:"!dept.folded"}],staticClass:"subDeptBox"},[e("div",{staticClass:"subDept name",class:{activated:t.stat.tree.current===a},attrs:{flex:"",ac:"",sm:""},on:{click:function(e){return t.select(a)}}},[e("div",{attrs:{"md-wd":"","wd-md":""}}),t._v(" "+t._s(a.name)+" "),e("i",{directives:[{name:"show",rawName:"v-show",value:t.editable&&t.stat.tree.current===a,expression:"editable && stat.tree.current === subDept"}],staticClass:"el-icon-edit",attrs:{"wd-xs":"","ht-xs":"",jc:"",ac:"",blue:"",pointer:""},on:{click:function(e){return e.stopPropagation(),t.edit(a)}}})]),t._l(a.children,(function(s,a){return e("div",{staticClass:"group name",class:{activated:t.stat.tree.current===s},attrs:{flex:"",ac:"",sm:""},on:{click:function(e){return t.select(s)}}},[e("div",{attrs:{"md-wd":"","wd-xl":""}}),t._v(" "+t._s(s.name)+" "),e("i",{directives:[{name:"show",rawName:"v-show",value:t.editable&&t.stat.tree.current===s,expression:"editable && stat.tree.current === group"}],staticClass:"el-icon-edit",attrs:{"wd-xs":"","ht-xs":"",jc:"",ac:"",blue:"",pointer:""},on:{click:function(e){return e.stopPropagation(),t.edit(s)}}})])}))],2)}))],2)})),0)])})),0),e("div",{staticClass:"funcBox",attrs:{flex:"",jsb:"","px-xl":"","md-px":"","lg-mt":"","mt-xl":""}},[e("div",{staticClass:"btn",attrs:{pointer:"","pl-sm":"",sm:"","wd-15":"",bold:"",bg:"","py-sm":"",jc:""},on:{click:t.insertFirm}},[t._v("＋添加公司")]),e("div",{staticClass:"btn",attrs:{pointer:"","pl-sm":"",sm:"","wd-15":"","wd-md":"",bold:"",bg:"","py-sm":"",jc:""},on:{click:t.insertDept}},[t._v("＋添加部门")]),e("div",{staticClass:"btn",attrs:{pointer:"","pl-sm":"",sm:"","wd-15":"",bold:"",bg:"","py-sm":"",jc:""},on:{click:t.insertCrew}},[t._v("＋添加成员")])])]):t._e()]),e("div",{attrs:{"ht-8":""}})],1)},i=[],r={name:"userManagementTree",inject:["data","stat","snap","api"],props:["getTrees"],created(){this.getTrees()},data(){return{}},computed:{editable(){return this.$store.state.devOption.department.editable}},methods:{select(t){this.stat.tree.current=t},toggle(t){t.folded=!t.folded,this.$nextTick((()=>{this.$forceUpdate()}))},edit(t){this.stat.dept.action="update",this.stat.dept.titleIndex=1,this.stat.dept.valid=!0},insertFirm(){this.stat.firm.valid=!0,console.log(1111)},insertDept(){this.stat.dept.titleIndex=0,this.stat.dept.action="insert",this.stat.dept.valid=!0},insertCrew(){this.stat.user.action="insert",this.stat.list.current=null,this.stat.user.valid=!0}}},l=r,n=s(1656),d=(0,n.A)(l,a,i,!1,null,"6333a511",null),c=d.exports},2196:function(t,e,s){s.r(e),s.d(e,{default:function(){return m}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"userManagement",attrs:{flex:"",relative:""}},[e("tree",{attrs:{getTrees:t.getTrees}}),e("list",{attrs:{getUsers:t.getUsers}}),e("firm",{on:{post:t.getTrees}}),e("dept",{attrs:{getTrees:t.getTrees}}),e("crew",{attrs:{getUsers:t.getUsers}})],1)},i=[],r=(s(4114),s(2173)),l=s(2058),n=s(3084),d=s(2972),c=s(7052),o={name:"userManagement",components:{tree:r["default"],list:l["default"],firm:n["default"],dept:d["default"],crew:c["default"]},created(){this.snap.dept=JSON.parse(JSON.stringify(this.data.dept)),this.snap.user=JSON.parse(JSON.stringify(this.data.user)),this.snap.stat=JSON.parse(JSON.stringify(this.stat))},data(){return{data:{raws:[],tree:{roots:[],companys:[],depts:[],subDepts:[],groups:[]},list:[],user:{portrait:"",online:"0",fullName:"",shortName:"",username:"",sexIndex:"0",cellPhone:"",officePhone:"",mail:"",address:"",deptName:"",deptLevel:"",deptId:"",position:"",superiorName:"",superiorId:"",roleIndex:"0"},dept:{name:"",officePhone:"",manager_id:"",manager_fullName:"",managerItem:null,superiorDeptName:"",superiorDeptItem:null}},stat:{tree:{current:null},list:{current:null,searchValue:"",currentPage:1,rowsPerPage:15,amount:0},user:{valid:!1,inputMode:"0",deleteConfirm:!1,pending:!1,action:""},dept:{valid:!1,deleteConfirm:!1,pending:!1,titleIndex:0,action:""},firm:{valid:!1,pending:!1}},snap:{dept:null,user:null,stat:null}}},provide(){return{data:this.data,stat:this.stat,snap:this.snap,api:this.api}},computed:{api(){return{treeData:"/userManagement/depts",listData:"/userManagement/users/"+this.stat.list.currentPage+"/"+this.stat.list.rowsPerPage+"?level="+this.level+"&search="+this.stat.list.searchValue,managers:"/userManagement/managers",amount:"/userManagement/dept/userAmount?level="+this.level+"&search="+this.stat.list.searchValue,dept:"/userManagement/dept",user:"/userManagement/user",firm:"/userManagement/firm"}},level(){return this.stat.tree.current?this.stat.tree.current.level+this.stat.tree.current.id+".":""}},watch:{level(t){this.stat.list.currentPage=1,this.getUsers()}},methods:{getTrees(){return new Promise((t=>{this.$http.get(this.api.treeData).then((e=>{this.data.raws=JSON.parse(JSON.stringify(e.data));for(let t in this.data.tree)this.data.tree[t]=[];e.data.forEach(((t,e)=>{t.folded=!1,t.children=[];let s=["roots","companys","depts","subDepts","groups"][t.level.split(".").length-1];this.data.tree[s].push(t)})),this.data.tree.groups.forEach((t=>{for(let e=0;e<this.data.tree.subDepts.length;e++)if(t.level===this.data.tree.subDepts[e].level+this.data.tree.subDepts[e].id+"."){this.data.tree.subDepts[e].children.push(t);break}})),this.data.tree.subDepts.forEach((t=>{for(let e=0;e<this.data.tree.depts.length;e++)if(t.level===this.data.tree.depts[e].level+this.data.tree.depts[e].id+"."){this.data.tree.depts[e].children.push(t);break}})),this.data.tree.depts.forEach((t=>{for(let e=0;e<this.data.tree.companys.length;e++)if(t.level===this.data.tree.companys[e].level+this.data.tree.companys[e].id+"."){this.data.tree.companys[e].children.push(t);break}})),this.$nextTick((()=>{t()}))}))}))},getUsers(){this.data.list=[],this.$http.get(this.api.listData).then((t=>{t.data.forEach((t=>{t.selected=!1})),this.data.list=t.data})),this.$http.get(this.api.amount).then((t=>{this.stat.list.amount=t.data}))}}},p=o,h=s(1656),u=(0,h.A)(p,a,i,!1,null,null,null),m=u.exports}}]);