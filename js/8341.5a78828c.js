"use strict";(self["webpackChunkdev"]=self["webpackChunkdev"]||[]).push([[8341,1259],{1259:function(t,e,s){s.r(e),s.d(e,{default:function(){return m}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"formset-row-remark",attrs:{fill:""}},[e("field",{attrs:{"nd-xs":"",noborder:"",fill:"",tile:"",noresize:"",js:"",ac:"",title:t.row[t.value],black:!t.editing},on:{focus:function(e){t.editing=!0},blur:function(e){t.editing=!1},enter:t.submit},model:{value:t.row[t.value],callback:function(e){t.$set(t.row,t.value,e)},expression:"row[value]"}})],1)},l=[],r={name:"formset-row-remark",data(){return{editing:!1,snapshot:"",flag:!1}},props:["row","value"],computed:{remark(){return this.row[this.value]}},watch:{remark:{handler:function(t){this.flag||(this.snapshot=t,this.flag=!0)},immediate:!0}},methods:{submit(){let t=this.remark;t.trim()!==this.snapshot&&this.$http.put(`/qualityControl/request/other/form/${this.row["requestGuid"]}?action=requestRemark`,{requestRemark:this.remark}).then((t=>{1===t.data?(this.snapshot=this.remark,this.$hint("备注已保存")):this.$hint({innerHTML:"备注失败",color:"red"})}))}}},i=r,o=s(1656),n=(0,o.A)(i,a,l,!1,null,null,null),m=n.exports},5199:function(t,e,s){s.r(e),s.d(e,{default:function(){return v}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"request"},[e("header",{attrs:{flex:"",jsb:"",ac:""}},[e("div",{attrs:{flex:""}},[e("btn",{attrs:{flat:"",blue:"",bg:"",sm:"","pl-sm":"","pr-lg":"","ht-3":"",tile:"","mr-xl":"",disabled:!t.stat.create},on:{click:function(e){return t.$refs.formset.dispatch("create")}}},[e("i",{attrs:{xl:"","nu-md":"","wd-1":""}},[t._v("＋")]),e("i",{attrs:{"nu-xs":""}},[t._v("新增")])]),e("btn",{directives:[{name:"show",rawName:"v-show",value:t.$store.state.devOption.qualityControl.requestDeletable&&!t.stat.selecting,expression:"$store.state.devOption.qualityControl.requestDeletable && !stat.selecting"}],attrs:{flat:"",blue:"",bg:"",sm:"","pl-sm":"","pr-lg":"","ht-3":"",tile:"","mr-xl":"",disabled:!t.stat.create},on:{click:function(e){t.$refs.formset.dispatch("toggleSelect"),t.toggleSelect()}}},[e("ico",{attrs:{"ml-sm":"","mr-xs":"",md:"","nu-xs":""}},[t._v("cbrankic-hecked")]),e("i",{attrs:{"nu-xs":""}},[t._v("选择")])],1),e("btn",{directives:[{name:"show",rawName:"v-show",value:t.$store.state.devOption.qualityControl.requestDeletable&&t.stat.selecting,expression:"$store.state.devOption.qualityControl.requestDeletable && stat.selecting"}],attrs:{flat:"",blue:"",outlined:"",sm:"","pl-sm":"","pr-lg":"","ht-3":"",tile:"","mr-xl":"",disabled:!t.stat.create},on:{click:function(e){t.$refs.formset.dispatch("toggleSelect"),t.toggleSelect()}}},[e("ico",{attrs:{"ml-sm":"","mr-xs":"",md:"","nu-xs":""}},[t._v("brankic-error")]),e("i",{attrs:{"nu-xs":""}},[t._v("取消")])],1),t.$store.state.devOption.qualityControl.requestDeletable?e("btn",{attrs:{flat:"",red:"",outlined:"",sm:"","pl-sm":"","pr-lg":"","ht-3":"",tile:"","mr-xl":"",disabled:!t.stat.create},on:{click:function(e){return t.$refs.formset.dispatch("deleteSelected")}}},[e("ico",{attrs:{"ml-sm":"","mr-xs":"",sm:"","nu-sm":""}},[t._v("icoMoon-bin")]),e("i",{attrs:{"nu-xs":""}},[t._v("删除")])],1):t._e()],1),e("field",{directives:[{name:"addon",rawName:"v-addon:suffix",value:t.searchIcon,expression:"searchIcon",arg:"suffix"}],staticClass:"searchBox",attrs:{outlined:"",tile:"",xs:"",placeholder:"精确搜索: 请输入日期、名称或功能查找服务"},on:{enter:t.search,clickSearch:t.search},model:{value:t.stat.search,callback:function(e){t.$set(t.stat,"search",e)},expression:"stat.search"}})],1),e("main",{attrs:{catskill:"",lighten:"",bg:"","sm-pa":"","pa-sm":"",flex:"",js:"",card:""}},[e("formset",{ref:"formset",attrs:{"lg-pt":"","pt-lg":"",noselect:!t.requestDeletable,"api:subject":"qualityControl/request/other/form","api:primary":"requestGuid",columns:t.columns,patch:{tabular:{width:"1200px"}}},on:{opened:t.opened,closed:t.closed},scopedSlots:t._u([{key:"form",fn:function(){return[e("div",{staticClass:"sketch210813",attrs:{flex:"",jc:"",loading:t.loading}},[e("div",{staticStyle:{width:"1100px"}},[e("h2",{attrs:{jc:"","xl-ls":"","ls-xl":"","md-mb":"","mb-lg":""}},[t._v("请验单")]),e("table",{attrs:{"xl-mb":"","mb-xl":"",relative:"","z-index-5":""}},[e("tr",[e("td",{attrs:{"wd-20":"",bold:"","ls-sm":""}},[e("div",{attrs:{"mx-auto":"","wd-14":"",jj:""}},[t._v("入库暂存单编号")])]),e("td",{attrs:{"wd-18":"",bold:"","ls-sm":"",jc:""}},[t._v("ZC 2019040601")]),e("td",{attrs:{"wd-17":"",bold:"","ls-sm":"",jc:""}},[e("div",{attrs:{"mx-auto":"","wd-11":"",jj:""}},[t._v("请验单编号")])]),e("td",{attrs:{"wd-19":"",jc:""}},[t._v(t._s(t.form.requestNum))]),e("td",{attrs:{"wd-17":"",bold:"",jc:""}},[e("div",{attrs:{"wd-13":"",jj:"","mx-auto":""}},[t._v("模 板")])]),e("td",{staticClass:"value input"},[e("div",{staticClass:"constraint"},[e("field",{directives:[{name:"valid",rawName:"v-valid:require",arg:"require"}],attrs:{select:"",fill:"",tile:"",blue:"","pl-md":"",jc:"",items:t.productTemplateNames,disabled:!t.form.isNew,placeholder:"请选择成品模板"},on:{select:t.select},model:{value:t.form.materialName,callback:function(e){t.$set(t.form,"materialName",e)},expression:"form.materialName"}})],1)])]),e("tr",[e("td",{attrs:{bold:"","ls-lg":""}},[e("div",{attrs:{"mx-auto":"","wd-14":"",jj:""}},[t._v("样品编码")])]),e("td",{attrs:{jc:""}},[t._v(t._s(t.form.sampleNum))]),e("td",{attrs:{jc:"","ls-lg":""}},[e("div",{attrs:{"mx-auto":"","wd-11":"",jj:"",bold:""}},[t._v("样品数量")])]),e("td",{attrs:{jc:"",relative:""}},[e("field",{attrs:{relative:"",fill:"",noborder:"",invalid:!t.sampleQuantityEditable},on:{enter:function(e){t.handleSampleQuantity(),t.createSampleTime()}},model:{value:t.form.sampleQuantity,callback:function(e){t.$set(t.form,"sampleQuantity",e)},expression:"form.sampleQuantity"}}),t.form.sampleQuantity?t._e():e("div",{staticClass:"sampleQuantity",attrs:{"ls-sm":""}},[t._v(t._s("("+t.suggest.quantity+"g)品控取样后填写"))])],1),e("td",{attrs:{jc:"","ls-lg":"",bold:""}},[t._v("取样/送样时间")]),e("td",{attrs:{jc:"","ls-sm":""}},[e("div",{class:{pink:!Boolean(t.form.sampleTime)}},[t._v(t._s(t.form.sampleTime?t.form.sampleTime:"填写样品数量后系统带出当天日期"))])])]),t.form.items.length>0?e("tr",{attrs:{noselect:""}},[e("td",{attrs:{colspan:"6",md:"",bold:"",jc:"","md-ls":"","ls-xl":""}},[t._v(" 检验项目 ")])]):t._e(),t._l(t.form.items,(function(s,a){return e("tr",{attrs:{noselect:""}},[e("td",{attrs:{colspan:"6"}},[e("div",{staticClass:"upperBox",attrs:{flex:"",bb:""}},[e("div",{staticClass:"groupName",attrs:{bold:"","ls-xl":""}},[t._v(" "+t._s(t.groupNames[a])+" ")]),e("div",{staticClass:"selectAll"},[e("field",{directives:[{name:"inject",rawName:"v-inject:label",value:"全 选",expression:"'全 选'",arg:"label"},{name:"addon",rawName:"v-addon:prefix",value:t.selectAllBox,expression:"selectAllBox",arg:"prefix"}],attrs:{check:"",noborder:""},on:{click:function(e){return t.toggleSelectAll(a)}},model:{value:t.selectAll[a],callback:function(e){t.$set(t.selectAll,a,e)},expression:"selectAll[groupIndex]"}})],1)]),e("div",{staticClass:"itemBox",class:{fix:1===a}},t._l(s.list,(function(s,l){return e("field",{directives:[{name:"addon",rawName:"v-addon:prefix",value:t.dotCheckBox,expression:"dotCheckBox",arg:"prefix"},{name:"inject",rawName:"v-inject:label",value:s.label,expression:"item.label",arg:"label"},{name:"inject",rawName:"v-inject:groupIndex",value:a,expression:"groupIndex",arg:"groupIndex"}],attrs:{check:"",noborder:"",js:"","ml-lg":"",sm:""},on:{change:function(e){return t.toggleItem(a,l)}},model:{value:s.valid,callback:function(e){t.$set(s,"valid",e)},expression:"item.valid"}})})),1)])])}))],2),e("div",{attrs:{"xl-mt":"","mt-lg":"","pt-xl":"",flex:"",je:""}},[e("btn",{attrs:{round:"","wd-12":"","xl-mr":"","mr-md":""},on:{click:function(e){return t.form.close()}}},[t._v("取消")]),e("btn",{attrs:{round:"","wd-12":"","xl-mr":"","mr-md":"",invalid:""}},[t._v("暂存")]),e("btn",{attrs:{round:"","wd-12":"","xl-ml":"",blue:"",bg:"",pending:t.pending,disabled:0===t.form.items.length},on:{click:t.submit}},[t._v(" 提交 ")])],1),e("gap",{attrs:{"py-xl":""}})],1)])]},proxy:!0}])})],1)])},l=[],r=(s(4114),s(4374)),i=s(6017),o=s(5835),n=s(1259),m=s(7920),u=s(4353),d=s.n(u),c={name:"request-other",mixins:[m["default"]],data(){return{form:{requestGuid:0,requestNum:"",batchNum:"",sampleNum:"",templateGuid:null,sampleQuantity:"",materialName:"",requestTime:"",sampleTime:"",sampler:"",requestStateCode:0,requestTypeIndex:3,items:[]},pending:!1,columns:[{label:"请验日期",value:"requestTime"},{label:"入库暂存单编号",value:"tempStorageNum",component:o["default"]},{label:"请验单编号",value:"requestNum",component:r.A},{label:"样品编码",value:"sampleNum",component:i.A},{label:"取样人",value:"sampler",width:150},{label:"备注",value:"requestRemark",width:350,component:n["default"]}],productTemplateGuids:[],productTemplateNames:[]}},computed:{url(){return{availableRequestNum:"/qualityControl/request/other/form/availableRequestNum",templateNames:"/qualityControl/request/other/templateNames",items:`/qualityControl/template/other/${this.form.templateGuid}/items`}}},methods:{opened(){this.stat.create=!1,this.$http.get(this.url.templateNames).then((t=>{this.productTemplateGuids=[],this.productTemplateNames=[];for(let e of t.data)this.productTemplateGuids.push(e.templateGuid),this.productTemplateNames.push(e.templateName)})),this.form.isNew?this.$http.get(this.url.availableRequestNum).then((t=>{this.form.requestNum="QYQ "+t.data,this.form.sampleNum="S "+t.data,this.loading=!1})):this.getItemsByRequestGuid()},select(t,e){this.form.templateGuid=this.productTemplateGuids[e],this.getItems()},getItems(){this.$http.get(this.url.items).then((t=>{this.form.items=t.data,this.initSelectAll(),this.$hint("请验项目已更新")}))},submit(){this.pending=!0,this.form.requestStateCode=this.form.sampleQuantity?1:0,this.form.requestTime||(this.form.requestTime=d()().format("YYYY-MM-DD HH:mm")),this.form.submit().then((t=>{1!==t&&0!==t&&alert("服务器出现问题，请刷新重试"),this.pending=!1}))}}},p=c,h=s(1656),f=(0,h.A)(p,a,l,!1,null,"04ebcbc8",null),v=f.exports}}]);